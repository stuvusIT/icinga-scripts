---
- name: Create scripts directory
  file:
    path: "{{ icinga2_scripts_path }}"
    state: directory
    mode: 0755
    owner: root
    group: root

- name: Install notification dependencies
  apt:
    name: "{{ item }}"
  with_items:
    - curl
  when: icinga2_needs_notification_scripts

- name: Install check dependencies
  apt:
    name: jq

- name: Copy common files
  copy:
    src: "{{ item }}"
    dest: "{{ icinga2_scripts_path }}"
    mode: 0644
    owner: root
    group: root
  with_items:
    - common.sh

- name: Copy check scripts
  copy:
    src: "check_{{ item }}"
    dest: "{{ icinga2_scripts_path }}"
    mode: 0755
    owner: root
    group: root
  with_items:
    - jenkins
    - kernel
    - services
    - tty
    - unifi

- name: Copy notification scripts
  copy:
    src: "notify_{{ item }}"
    dest: "{{ icinga2_scripts_path }}"
    mode: 0755
    owner: root
    group: root
  with_items:
    - host_mattermost
    - service_mattermost
  when: icinga2_needs_notification_scripts
